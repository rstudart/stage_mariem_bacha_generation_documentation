webpackJsonp([2],{193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(192);var a=n(17),i=n(194),s=function(){function e(){}return e.UpdateItem=function(t,n,i,s){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){switch(r.label){case 0:return[4,a.SharePointServices.AddOrUpdateItem(n,t)];case 1:return r.sent(),[4,e.SetWorkFlowInstance(n.WFInstanceID,i,s)];case 2:return r.sent(),[2]}})})},e.GetTaskConfiguration=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return void 0===i.Context.TaskId||void 0===i.Context.TaskListUrl?[3,2]:[4,a.SharePointServices.GetItemById(i.Context.TaskListUrl,i.Context.TaskId)];case 1:return[2,e.sent().get_fieldValues()];case 2:throw Error("Paramètre(s) manquant(s)")}})})},e.SetWorkFlowInstance=function(e,t,n){return r.__awaiter(this,void 0,void 0,function(){var s,o,l,u;return r.__generator(this,function(r){switch(r.label){case 0:return s=window.location,o=s.protocol+"//"+s.hostname,void 0!==s.port&&""!==s.port&&(o+=":"+s.port),l={ID:e,WFState:"En cours",WFItemState:n,WFNote:t},u={ID:i.Context.TaskId,PercentComplete:1,Status:"Terminé"},[4,a.SharePointServices.AddOrUpdateItem(l,"Lists/WorkFlowInstance",void 0,o+"/sites/config")];case 1:return r.sent(),[4,a.SharePointServices.AddOrUpdateItem(u,i.Context.TaskListUrl,void 0)];case 2:return r.sent(),[2]}})})},e.GetWebUrl=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return[4,a.SharePointServices.GetCurrentSiteUrl()];case 1:return[2,e.sent()]}})})},e.GetItem=function(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(n){switch(n.label){case 0:return[4,a.SharePointServices.GetItemById(e,t)];case 1:return[2,n.sent().get_fieldValues()]}})})},e.GetFields=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,a.SharePointServices.GetFields(e)];case 1:return[2,t.sent().get_data()]}})})},e.IsAllowed=function(e){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return t=e.get_lookupValue(),[4,a.SharePointServices.GetCurrentUser()];case 1:return n.sent().get_id()===e.get_lookupId()?[2,!0]:[2,a.SharePointServices.IsCurrentUserMemberOfGroup(t)]}})})},e}();t.WorkflowServices=s},194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function e(){if(void 0===e.TaskId||void 0===e.TaskListUrl){var t=new URLSearchParams(window.location.search);e.TaskId=t.has("TaskId")?parseInt(t.get("TaskId"),10):void 0,e.TaskListUrl=t.has("TaskId")?t.get("TaskListUrl"):void 0}}}();t.Context=r;var a=new r;t.context=a},195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(17),i=r.__importDefault(n(2)),s=n(580);a.RenderComponent(i.default.createElement(s.WorkFlowTask,null))},580:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=n(9),i=r.__importDefault(n(2)),s=n(581),o=n(47),l=n(582),u=n(193),c=n(194),d=n(583);n(584);var f=function(e){function t(t){var n=e.call(this,t)||this;return n.GetField=function(e){return n.state.ListItemFields.find(function(t){return t.get_internalName()===e})},n.SetNote=function(e){n.setState({Note:e})},n.Init=function(){return r.__awaiter(n,void 0,void 0,function(){var e,t,n,a,i,s;return r.__generator(this,function(o){switch(o.label){case 0:return[4,u.WorkflowServices.GetTaskConfiguration()];case 1:return e=o.sent(),t=this.state,(n=Object.assign(t,r.__assign({},e,{IsLoading:!1}))).ItemInfo=JSON.parse(n.SerializedItemInfo),n.TaskInfo=JSON.parse(n.SerializedTaskInfo),document.getElementById("DeltaPlaceHolderPageTitleInTitleArea").innerHTML=n.TaskInfo.Title,void 0===n.AssignedTo?[3,3]:(a=n,[4,u.WorkflowServices.IsAllowed(n.AssignedTo)]);case 2:a.IsAllowed=o.sent(),o.label=3;case 3:return i=n,[4,u.WorkflowServices.GetItem(n.ItemInfo.ListUrl,n.ItemInfo.ItemID)];case 4:return i.Item=o.sent(),s=n,[4,u.WorkflowServices.GetFields(n.ItemInfo.ListUrl)];case 5:return s.ListItemFields=o.sent(),this.setState(n),[2]}})})},n.UpdateState=function(e){n.setState({IsSaving:!0});var t={ID:n.state.Item.ID};return t[n.state.ItemInfo.StatusColumn]=e,t.WFInstanceID=n.state.WFInstanceID,u.WorkflowServices.UpdateItem(n.state.ItemInfo.ListUrl,t,n.state.Note,e).then(function(){return n.setState({IsSaving:!1})}).catch(function(e){throw n.setState({IsSaving:!1}),e})},n.state=Object.assign(new d.Task,{IsSaving:!1,IsLoading:!0,Item:void 0,Note:"",IsAllowed:!1,ListItemFields:[]}),n.Init(),n}return r.__extends(t,e),t.prototype.render=function(){var e=this;return i.default.createElement(o.Container,null,void 0!==this.state.Item&&!this.state.IsAllowed&&i.default.createElement(a.Label,{className:"ms-fontSize-xxl"},"  Désolé.. cette tâche ne vous est pas assignée. "),void 0!==this.state.Item&&this.state.IsAllowed&&i.default.createElement("div",null,this.state.TaskInfo.Fields.map(function(t,n){return i.default.createElement(s.Field,{key:n,Field:e.GetField(t.InternalName),Label:t.Label,Item:e.state.Item,InternalName:t.InternalName})}),"Terminé"!==this.state.Status&&"Attente de quelqu'un d'autre"!==this.state.Status&&i.default.createElement("div",null,i.default.createElement(o.Row,null,i.default.createElement(o.Col,{Size:10},i.default.createElement(a.TextField,{multiline:!0,label:"Remarques :",value:this.state.Note,onChanged:this.SetNote}))),i.default.createElement(o.Row,null,i.default.createElement(o.Col,{Size:10,className:"WF-Buttons"},this.state.TaskInfo.Actions.map(function(t,n){return i.default.createElement(l.Action,{key:n,TaskUrl:c.Context.TaskListUrl,NextStatus:t.NextStatus,DispalyText:t.DispalyText,Update:e.UpdateState})})),i.default.createElement(o.Col,{Size:2})))),i.default.createElement(o.BlockUI,{Block:this.state.IsSaving,Text:"Sauvegarde en cours..."}),i.default.createElement(o.BlockUI,{Block:this.state.IsLoading,Text:"Chargement..."}))},t}(a.BaseComponent);t.WorkFlowTask=f},581:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=r.__importDefault(n(2)),i=n(9),s=n(47),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GetFormattedValue=function(){switch(t.props.Field.get_fieldTypeKind()){case SP.FieldType.dateTime:var e={};return e=t.props.Field.get_displayFormat()!==SP.DateTimeFieldFormatType.dateOnly?{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}:{weekday:"long",year:"numeric",month:"long",day:"numeric"},t.props.Item[t.props.InternalName].toLocaleDateString("fr-fr",e);case SP.FieldType.boolean:return t.props.Item[t.props.InternalName]?"Oui":"Non";case SP.FieldType.user:case SP.FieldType.user:return t.props.Item[t.props.InternalName].get_lookupValue();case SP.FieldType.URL:var n=t.props.Item[t.props.InternalName];return a.default.createElement("a",{href:n.get_url()}," ",n.get_description(),"  ");default:return t.props.Item[t.props.InternalName].toString()}},t}return r.__extends(t,e),t.prototype.render=function(){return a.default.createElement(s.Row,null,a.default.createElement(s.Col,{Size:2},a.default.createElement(i.Label,null," ",this.props.Label+" :"," ")," "),a.default.createElement(s.Col,{Size:8},a.default.createElement(i.Label,null,"  ",this.GetFormattedValue())))},t}(a.default.PureComponent);t.Field=o},582:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),a=r.__importDefault(n(2)),i=n(9),s=n(47),o=n(193),l=function(e){function t(t){var n=e.call(this,t)||this;return n.onClick=function(){n.setState({disabled:!0});var e=n.props.TaskUrl.startsWith("/")?n.props.TaskUrl:"/"+n.props.TaskUrl;n.props.Update(n.props.NextStatus).then(function(){return r.__awaiter(n,void 0,void 0,function(){return r.__generator(this,function(t){return this.setState({disabled:!1}),o.WorkflowServices.GetWebUrl().then(function(t){return window.location.replace(t+e)}),[2]})})}).catch(function(){return n.setState({disabled:!1})})},n.state={disabled:!1},n}return r.__extends(t,e),t.prototype.render=function(){return a.default.createElement(s.Col,{Size:2},a.default.createElement(i.DefaultButton,{text:this.props.DispalyText,onClick:this.onClick}))},t}(a.default.Component);t.Action=l},583:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.WFInstanceID=0,this.WFIdentifier="",this.SerializedTaskInfo="",this.SerializedItemInfo="",this.Status="",this.TaskInfo={Actions:[],Fields:[],Title:""},this.ItemInfo={ItemID:0,StatusColumn:"",ListUrl:""}}}();t.Task=r},584:function(e,t,n){var r=n(585);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(21)(r,a);r.locals&&(e.exports=r.locals)},585:function(e,t,n){(e.exports=n(20)(!1)).push([e.i,".WF-Buttons * {\r\n    float: right !important;\r\n}\r\n\r\n.WF-Buttons {\r\n    padding-top: 10px;\r\n    padding-right: 0px !important;\r\n}",""])}},[195]);