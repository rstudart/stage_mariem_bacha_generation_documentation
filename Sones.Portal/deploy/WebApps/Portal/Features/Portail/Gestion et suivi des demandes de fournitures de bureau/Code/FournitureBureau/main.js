webpackJsonp([2],{192:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.ID=0,this.DateDemandeFournitureBureau=new Date(Date.now()),this.Direction="",this.CodeDirection="",this.StatutDemandeFournitureBureau="",this.SerializedArticlesFourniture="[]",this.Articles=[]}}();t.Demande=n},193:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(13),i=r(6),s=r(192),o="<View><Query><Where><Or><Contains><FieldRef Name='CodeArticleFournitureBureau' /><Value Type='Text'>{code}</Value></Contains><Contains><FieldRef Name='ArticleFournitureBureau' /><Value Type='Text'>{code}</Value></Contains></Or></Where></Query><RowLimit>5</RowLimit></View>",u="<View><Query><Where><Contains><FieldRef Name='ArticleFournitureBureau' /><Value Type='Text'>{code}</Value></Contains></Where></Query><RowLimit>5</RowLimit></View>",l=function(){function e(){}return e.GetArticle=function(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return isNaN(parseInt(e,10))?[4,a.SharePointServices.GetItems(u.replace("{code}",e+""),"Lists/Fournitures")]:[3,2];case 1:return[2,t.sent().get_data().map(function(e){return e.get_fieldValues()})];case 2:return[4,a.SharePointServices.GetItems(o.replace("{code}",e+""),"Lists/Fournitures")];case 3:return[2,t.sent().get_data().map(function(e){return e.get_fieldValues()})]}})})},e.GetUserGroups=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return[4,a.SharePointServices.GetCurrentUserGroups()];case 1:return[2,e.sent().get_data().map(function(e){return e.get_title()})]}})})},e.GetDemande=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return i=(r=a.helper).GetClassPropertiesOnly,o=[new s.Demande],[4,a.SharePointServices.GetItemById("Lists/DemandeFourniture",e)];case 1:return(t=i.apply(r,o.concat([n.sent().get_fieldValues()]))).Articles=JSON.parse(t.SerializedArticlesFourniture),[2,t]}})})},e.Save=function(e,t){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(n){switch(n.label){case 0:return(r=Object.assign({},e)).SerializedArticlesFourniture=JSON.stringify(e.Articles),console.log(r),void 0!==t&&(r.StatutDemandeFournitureBureau=t),[4,a.SharePointServices.AddOrUpdateItem(r,"Lists/DemandeFourniture")];case 1:return n.sent(),[2,!0]}})})},e.GetUserDirection=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,a.SharePointServices.GetCurrentUserDirection()]})})},n.__decorate([i.memoize],e,"GetArticle",null),e}();t.FournitureBureauServices=l},194:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(13),i=n.__importDefault(r(2)),s=r(580);a.RenderComponent(i.default.createElement(s.Formulaire,null))},580:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(192),i=r(6),s=n.__importDefault(r(2));r(581);var o=r(583),u=r(26),l=r(584),c=r(193),d=r(589),f=function(e){function t(t){var r=e.call(this,t)||this;return r.showEdit=function(){return"Validée Moyens Généraux"===r.state.StatutDemandeFournitureBureau||"Livrée"===r.state.StatutDemandeFournitureBureau},r.save=function(){r.setState({IsSaving:!0}),c.FournitureBureauServices.Save(r.state).then(function(){r.setState({IsSaving:!1}),window.location.replace("/Lists/DemandeFourniture")}).catch(function(e){r.setState({IsSaving:!1}),console.log(e)})},r.OnUserGroupsChange=function(e){r.setState({UserGroups:e})},r.CanEditDate=function(){return""===r.state.StatutDemandeFournitureBureau},r.approve=function(){var e=r.GetConfig();r.setState({IsSaving:!0}),c.FournitureBureauServices.Save(r.state,e.StateTo).then(function(){r.setState({IsSaving:!1}),window.location.replace("/Lists/DemandeFourniture")}).catch(function(e){r.setState({IsSaving:!1}),alert("Erreur lors du sauvgarde"+e.get_message()),console.log(e)})},r.CanApprove=function(){var e=r.GetConfig();return void 0!==e&&""!==e.StateTo},r.CanSave=function(){var e=r.GetConfig();return void 0!==e&&e.CanSave},r.CanEdit=function(){var e=r.GetConfig();return void 0!==e&&e.CanEdit},r.CanReject=function(){var e=r.GetConfig();return void 0!==e&&e.CanReject},r.GetConfig=function(){return d.StateManagement.StateConfig.find(function(e){return e.State===r.state.StatutDemandeFournitureBureau&&-1!==r.state.UserGroups.indexOf(e.Group)})},r.Reject=function(){r.setState({IsSaving:!0}),c.FournitureBureauServices.Save(r.state,d.StateManagement.RejectionState).then(function(){r.setState({IsSaving:!1}),window.history.go(-1)}).catch(function(e){r.setState({IsSaving:!1}),console.log(e)})},r.onArticlesChange=function(e){r.setState({Articles:e})},r.buttonEnabled=function(){return void 0!==r.state.DateDemandeFournitureBureau&&""!==r.state.Direction&&r.state.Articles.length>0&&!r.state.IsSaving},r.onDateChange=function(e){r.setState({DateDemandeFournitureBureau:e})},r.state=n.__assign({},new a.Demande,{IsSaving:!1,IsLoading:!0,UserGroups:[],Title:"Page"}),r.Intialize(),r}return n.__extends(t,e),t.prototype.Intialize=function(){var e=this;c.FournitureBureauServices.GetUserGroups().then(function(t){e.setState({UserGroups:t})});var t=new URLSearchParams(window.location.search),r=t.has("ID")?t.get("ID"):"";""!==r?c.FournitureBureauServices.GetDemande(parseInt(r,10)).then(function(t){e.setState(n.__assign({},t,{IsLoading:!1,Title:"Modifier la demande"}))}).catch(function(e){return alert(e.get_message())}):c.FournitureBureauServices.GetUserDirection().then(function(t){""===e.state.Direction&&e.setState({IsLoading:!1,Direction:t.NameDirection,CodeDirection:t.CodeDirection,Title:"Nouvelle demande"})}).catch(function(e){return alert(e)})},t.prototype.render=function(){return s.default.createElement(u.FormContainer,{isSaving:this.state.IsSaving,isLoading:this.state.IsLoading,allowedGroups:d.AllowedGroups,title:this.state.Title,onUserGroupsChange:this.OnUserGroupsChange},s.default.createElement(u.Row,null,s.default.createElement(u.Col,{Size:6},s.default.createElement(o.DateCommandePicker,{onChanged:this.onDateChange,Date:this.state.DateDemandeFournitureBureau,Disabled:!this.CanEditDate()})),s.default.createElement(u.Col,{Size:3}),s.default.createElement(u.Col,{Size:3},s.default.createElement(i.Label,null," ",s.default.createElement("strong",null," Direction :")," ",this.state.Direction," "))),s.default.createElement(u.Row,null,s.default.createElement(u.Col,{Size:12},s.default.createElement(l.Articles,{Articles:this.state.Articles,OnChanged:this.onArticlesChange,ShowEdit:this.showEdit(),Disabled:!this.CanEdit()}))),s.default.createElement(u.Row,null,s.default.createElement(u.Col,{Size:12},s.default.createElement("div",{className:"button-bar"},this.CanApprove()&&s.default.createElement(i.PrimaryButton,{text:this.GetConfig().ButtonText,disabled:!this.buttonEnabled(),onClick:this.approve}),this.CanSave()&&s.default.createElement(i.PrimaryButton,{text:"Enregistrer",disabled:!this.buttonEnabled(),onClick:this.save}),this.CanReject()&&s.default.createElement(i.PrimaryButton,{text:"Reject",disabled:!this.buttonEnabled(),onClick:this.Reject})))))},t}(i.BaseComponent);t.Formulaire=f},581:function(e,t,r){var n=r(582);"string"==typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(21)(n,a);n.locals&&(e.exports=n.locals)},582:function(e,t,r){(e.exports=r(20)(!1)).push([e.i,".sug-item {\r\n    text-align: left;\r\n}\r\n\r\n.ms-Suggestions-itemButton {\r\n    padding: 5px 12px !important;\r\n}\r\n\r\n.button-bar {\r\n    float: right;\r\n    padding-top: 6px;\r\n    padding-bottom: 6px;\r\n}\r\n\r\n.ms-DatePicker-wrap button {\r\n    min-width: 0;\r\n}\r\n\r\n.ms-Table-div {\r\n    padding-top: 15px;\r\n}\r\n\r\n.errormessage {\r\n    font-size: 12px;\r\n    font-weight: 400;\r\n    color: #a80000;\r\n    margin: 0;\r\n    padding-top: 5px;\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -webkit-box-align: center;\r\n    -ms-flex-align: center;\r\n    white-space: pre-wrap;\r\n    align-items: center;\r\n}",""])},583:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=n.__importDefault(r(2)),s=r(13),o=r(26),u=function(e){function t(t){var r=e.call(this,t)||this;return r.getErrorMessage=function(){return r.IsNullOrWhiteSpace(r.state.errorMessage)?i.default.createElement("div",null):i.default.createElement("div",{"aria-live":"assertive"},i.default.createElement(a.DelayedRender,null,i.default.createElement("span",{className:"ms-TextField-errorMessage css-43"},i.default.createElement("span",{"data-automation-id":"error-message",className:"errormessage"},r.state.errorMessage))))},r.onDateChanged=function(e){null===e&&(e=void 0),r.setState({errorMessage:o.required()(e)}),r.props.onChanged(e)},r.onFormatDate=function(e){if(void 0!==e){return e.toLocaleDateString("fr-fr",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return""},r.state={errorMessage:""},r}return n.__extends(t,e),t.prototype.render=function(){return i.default.createElement("div",null,i.default.createElement(a.Label,{required:!0}," Date de la demande"),i.default.createElement(a.DatePicker,{className:""!==this.state.errorMessage?"invalid":"",strings:s.DayPickerStrings,onSelectDate:this.onDateChanged,value:this.props.Date,disabled:this.props.Disabled,formatDate:this.onFormatDate}),this.getErrorMessage())},t.prototype.IsNullOrWhiteSpace=function(e){return void 0===e||null===e||null!==e.match(/^ *$/)},t}(a.BaseComponent);t.DateCommandePicker=u},584:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=n.__importDefault(r(2)),s=r(585),o=r(586),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return i.default.createElement("div",null,i.default.createElement(s.ArticleTable,{OnChanged:this.props.OnChanged,Articles:this.props.Articles,Disabled:this.props.Disabled,ShowEdit:this.props.ShowEdit}),!this.props.ShowEdit&&!this.props.Disabled&&i.default.createElement(o.ArticleForm,{key:this.props.Articles.length,OnChanged:this.props.OnChanged,Articles:this.props.Articles}))},t}(a.BaseComponent);t.Articles=u},585:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=n.__importDefault(r(2)),s=r(26),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onQuantiteGetErrorMessage=function(e){var t=s.required()(e);return""===t&&""===(t=s.isInteger()(e))&&parseFloat(e)<=0&&(t="La valeur doit être strictement positive"),t},t.GetSize=function(){return t.props.ShowEdit?2:3},t.DeleteArticle=function(e){if(confirm("Êtes-vous sûr de vouloir supprimer ?")&&void 0!==e){var r=t.props.Articles;r.splice(e,1),t.props.OnChanged(r)}},t}return n.__extends(t,e),t.prototype.render=function(){var e=this;return i.default.createElement("div",{className:"ms-Table-div"},i.default.createElement(s.MSTable,null,i.default.createElement(s.MSTableRow,{Header:!0},i.default.createElement(s.MSTableCell,{Size:this.GetSize()}," Code article "),i.default.createElement(s.MSTableCell,{Size:this.GetSize()}," Article "),i.default.createElement(s.MSTableCell,{Size:this.GetSize()}," Quantité demandée "),this.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:2}," Quantité Livrée "),this.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:4}," Observation "),!this.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:3},"   ")),this.props.Articles.map(function(t,r){return i.default.createElement(s.MSTableRow,{key:r},i.default.createElement(s.MSTableCell,{Size:e.GetSize()}," ",t.CodeArticle," "),i.default.createElement(s.MSTableCell,{Size:e.GetSize()}," ",t.Article," "),i.default.createElement(s.MSTableCell,{Size:e.GetSize()}," ",t.QuantiteDemandee," "),e.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:2},i.default.createElement(a.TextField,{validateOnFocusOut:!0,validateOnLoad:!1,onChanged:function(e){t.QuantiteLivree=e},value:t.QuantiteLivree+"",placeholder:"Quantité livrée",onGetErrorMessage:e.onQuantiteGetErrorMessage})),e.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:4},i.default.createElement(a.TextField,{validateOnFocusOut:!0,validateOnLoad:!1,multiline:!0,value:t.Observation,onChanged:function(e){t.Observation=e}})),!e.props.ShowEdit&&i.default.createElement(s.MSTableCell,{Size:3},!e.props.Disabled&&i.default.createElement(a.IconButton,{iconProps:{iconName:"Delete"},title:"Supprimer",onClick:function(){return e.DeleteArticle(r)}})))})))},t}(a.BaseComponent);t.ArticleTable=o},586:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=r(587),s=n.__importDefault(r(2)),o=r(588),u=r(26),l=function(e){function t(t){var r=e.call(this,t)||this;return r.IsSaveDisabled=function(){return!(""!==r.state.Article&&0!==r.state.CodeArticle&&r.state.QuantiteDemandee>0)},r.onQuantiteChanged=function(e){r.setState({QuantiteDemandee:e})},r.onQuantiteGetErrorMessage=function(e){var t=u.required()(e);return""===t&&""===(t=u.isInteger()(e))&&parseFloat(e)<=0&&(t="La valeur doit être strictement positive"),t},r.onArticleChanged=function(e){void 0===e?r.setState({Article:"",CodeArticle:0}):r.setState({Article:e.ArticleFournitureBureau,CodeArticle:e.CodeArticleFournitureBureau})},r.SaveArticle=function(){var e=r.props.Articles;e.push(r.state),r.props.OnChanged(e)},r.state=new o.ArticleDemande,r}return n.__extends(t,e),t.prototype.render=function(){return s.default.createElement(u.Row,null,s.default.createElement(u.Col,{Size:6},s.default.createElement(i.ArticlePicker,{onChanged:this.onArticleChanged})),s.default.createElement(u.Col,{Size:4},s.default.createElement(a.TextField,{validateOnFocusOut:!0,validateOnLoad:!1,onChanged:this.onQuantiteChanged,placeholder:"Quantité  demandée",onGetErrorMessage:this.onQuantiteGetErrorMessage})),s.default.createElement(u.Col,{Size:2},s.default.createElement(a.DefaultButton,{text:"Ajouter",title:"Ajouter un article",iconProps:{iconName:"Add"},disabled:this.IsSaveDisabled(),onClick:this.SaveArticle})))},t}(a.BaseComponent);t.ArticleForm=l},587:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=n.__importDefault(r(2)),s=r(193),o=r(26),u=function(e){function t(t){var r=e.call(this,t)||this;return r.onChange=function(e){void 0===e||0===e.length?(r.setState({errorMessage:"",selectedItem:void 0}),r.props.onChanged(void 0)):(r.setState({errorMessage:"",selectedItem:e[0]}),r.props.onChanged({CodeArticleFournitureBureau:parseInt(e[0].key,10),ArticleFournitureBureau:e[0].name}))},r.getErrorMessage=function(){return r.IsNullOrWhiteSpace(r.state.errorMessage)?i.default.createElement("div",null):i.default.createElement("div",{"aria-live":"assertive"},i.default.createElement(a.DelayedRender,null,i.default.createElement("span",{className:"ms-TextField-errorMessage css-43"},i.default.createElement("span",{"data-automation-id":"error-message",className:"errormessage"},r.state.errorMessage))))},r.onRenderSuggestionsItem=function(e,t){return i.default.createElement("div",{className:"sug-item"},i.default.createElement("strong",null,"Article :"),e.name,i.default.createElement("br",null),i.default.createElement("strong",null,"Code article :"),e.key)},r.onResolveSuggestions=function(e,t){return n.__awaiter(r,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,s.FournitureBureauServices.GetArticle(e)];case 1:return[2,r.sent().map(function(e){return{key:e.CodeArticleFournitureBureau+"",name:e.ArticleFournitureBureau}})];case 2:return t=r.sent(),console.log(t),[2,[]];case 3:return[2]}})})},r.validate=function(){void 0===r.state.selectedItem?r.setState({errorMessage:o.required()()}):r.setState({errorMessage:""})},r.selectedItems=function(){return void 0===r.state.selectedItem?[]:[r.state.selectedItem]},r.state={errorMessage:""},r}return n.__extends(t,e),t.prototype.render=function(){return i.default.createElement("div",null,i.default.createElement(a.TagPicker,{className:"ms-sm12 ms-md12 ms-lg12 "+(""!==this.state.errorMessage?"invalid":""),selectedItems:this.selectedItems(),getTextFromItem:function(e){return e.name},pickerSuggestionsProps:{suggestionsHeaderText:"Suggestions",noResultsFoundText:"Aucun resultat"},onChange:this.onChange,itemLimit:1,inputProps:{onBlur:this.validate,placeholder:"Article"},onResolveSuggestions:this.onResolveSuggestions,onRenderSuggestionsItem:this.onRenderSuggestionsItem}),this.getErrorMessage())},t.prototype.IsNullOrWhiteSpace=function(e){return void 0===e||null===e||null!==e.match(/^ *$/)},t}(a.BaseComponent);t.ArticlePicker=u},588:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){this.CodeArticle=0,this.Article="",this.QuantiteDemandee=0,this.QuantiteLivree=0,this.Observation=""}}();t.ArticleDemande=n},589:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateManagement={RejectionState:"Refusée",StateConfig:[{State:"",Group:"Demandes de fournitures de bureau - Secrétaires",StateTo:"Soumise",CanReject:!1,CanSave:!1,CanEdit:!0,ButtonText:"Soumettre"},{State:"Soumise",Group:"Demandes de fournitures de bureau - Directeurs",StateTo:"Validée Direction",CanReject:!0,CanEdit:!1,CanSave:!1,ButtonText:"Validation direction"},{State:"Validée Direction",Group:"Demandes de fournitures de bureau - Chefs de division achats",StateTo:"Validée Achat",CanReject:!0,CanEdit:!1,CanSave:!1,ButtonText:"Validation Achat"},{State:"Validée Achat",Group:"Demandes de fournitures de bureau - Chefs des services généraux",StateTo:"Validée Moyens Généraux",CanReject:!0,CanEdit:!1,CanSave:!1,ButtonText:"Validation Moyens Généraux"},{State:"Validée Moyens Généraux",Group:"Demandes de fournitures de bureau - Secrétaires",StateTo:"Livrée",CanReject:!1,CanEdit:!0,CanSave:!0,ButtonText:"Valider la livraison"}]},t.AllowedGroups=["Demandes de fournitures de bureau - Secrétaires","Demandes de fournitures de bureau - Directeurs","Demandes de fournitures de bureau - Chefs de division achats","Demandes de fournitures de bureau - Chefs des services généraux","Demandes de fournitures de bureau - Gestionnaires"]}},[194]);